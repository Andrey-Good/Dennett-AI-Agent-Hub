# /.github/workflows/lint.yml

name:  Lint & Test Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  # =======================================================
  # ЗАДАЧА 1: ПРОВЕРИТЬ PYTHON (BACKEND)
  # =======================================================
  lint-backend:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./backend # Говорим, что работать надо в папке /backend
    
    steps:
    - name: 1. Checkout code
      uses: actions/checkout@v4

    - name: 2. Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11' 

    - name: 3. Install Dependencies
      run: |
        pip install -r requirements.txt
        pip install -r requirements-dev.txt
        
    - name: 4. Run Ruff (Format Check)
      run: ruff format --check .

    - name: 5. Run Ruff (Linter)
      run: ruff check .
      
    - name: 6. Run Mypy (Type Check)
      run: mypy .
      
    - name: 7. Run Bandit (Security)
      run: bandit -r .

    # Раскомментируй, когда у тебя появятся тесты
    # - name: 8. Run Pytest
    #   run: pytest

  # =======================================================
  # ЗАДАЧА 2: ПРОВЕРИТЬ JAVASCRIPT (FRONTEND)
  # =======================================================
  lint-frontend:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./frontend # Говорим, что работать надо в папке /frontend
        
    steps:
    - name: 1. Checkout code
      uses: actions/checkout@v4

    - name: 2. Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: 3. Install Dependencies
      run: npm install
      
    - name: 4. Run Prettier (Format Check)
      run: npm run format-check # <-- Ты должен создать этот скрипт в package.json!
      
    - name: 5. Run ESLint
      run: npm run lint # <-- Этот скрипт у тебя уже должен быть
      
    # Раскомментируй, когда появятся тесты
    # - name: 6. Run Tests
    #   run: npm run test

  # =======================================================
  # ЗАДАЧА 3: ПРОВЕРИТЬ RUST (TAURI)
  # =======================================================
  lint-rust:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./frontend/src-tauri # Говорим, где лежит Rust
        
    steps:
    - name: 1. Checkout code
      uses: actions/checkout@v4
      
    - name: 2. Set up Rust
      uses: dtolnay/rust-toolchain@stable
      
    - name: 3. Run Cargo Fmt (Format Check)
      run: cargo fmt -- --check
      
    - name: 4. Run Cargo Clippy (Linter)
      run: cargo clippy -- -D warnings # -D warnings = все варнинги станут ОШИБКАМИ
      
    # Раскомментируй, когда появятся тесты
    # - name: 5. Run Tests
    #   run: cargo test