# /.pre-commit-config.yaml

repos:
# ===================================================================
# ОБЩИЕ ПРОВЕРКИ (Для всех файлов)
# ===================================================================
-   repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
    -   id: trailing-whitespace   # Убивает лишние пробелы в конце строк
    -   id: end-of-file-fixer     # Гарантирует пустую строку в конце файла
    -   id: check-yaml            # Проверяет .yaml файлы
    -   id: check-json            # Проверяет .json
    -   id: check-toml            # Проверяет .toml
    -   id: check-merge-conflict  # Орет, если ты забыл убрать "<<<<< HEAD"

# ===================================================================
# 1. СТЕК PYTHON (Работает ТОЛЬКО в папке /backend)
# ===================================================================
-   repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.4.4
    hooks:
    -   id: ruff
        name: ruff (lint)
        args: [--fix, --exit-non-zero-on-fix]
        files: ^backend/  # <-- Работает только на backend/
    -   id: ruff-format
        name: ruff (format)
        files: ^backend/  # <-- Работает только на backend/

-   repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.10.0
    hooks:
    -   id: mypy
        name: mypy
        files: ^backend/
        args: [--config-file=backend/mypy.ini] # Настройки mypy вынеси в отдельный файл
        additional_dependencies: [
            "types-requests", 
            "sqlalchemy-stubs",
            "fastapi-stubs" # и прочие стабы для библиотек
        ]

-   repo: https://github.com/PyCQA/bandit
    rev: 1.7.8
    hooks:
    -   id: bandit
        name: bandit
        files: ^backend/
        args: ["-c", "backend/bandit.yaml"] # Настройки bandit тоже вынеси

# ===================================================================
# 2. СТЕК JAVASCRIPT (Работает ТОЛЬКО в папке /frontend)
# ===================================================================
-   repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
    -   id: prettier
        name: prettier (js/ts/css/md)
        files: ^frontend/
        exclude: ^frontend/src-tauri/ # Исключаем Rust-код

# ===================================================================
# 3. СТЕК RUST (Работает ТОЛЬКО в папке /frontend/src-tauri)
# ===================================================================
-   repo: local
    hooks:
    -   id: cargo-fmt
        name: cargo fmt
        entry: cargo fmt -- --check
        language: rust
        files: ^frontend/src-tauri/src/.*\.(rs)$
        pass_filenames: false
    -   id: cargo-clippy
        name: cargo clippy
        entry: cargo clippy -- --deny warnings
        language: rust
        files: ^frontend/src-tauri/src/.*\.(rs)$
        pass_filenames: false